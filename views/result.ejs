<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analysis – DevInsight</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; background: #0f0f1a; color: #e4e4e7; padding: 1.5rem; line-height: 1.5; }
    a { color: #818cf8; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .wrap { max-width: 900px; margin: 0 auto; }
    .back { margin-bottom: 1.5rem; }
    h1 { font-size: 1.5rem; margin: 0 0 1.5rem; color: #a5b4fc; }
    h2 { font-size: 1.1rem; margin: 1.75rem 0 0.75rem; color: #c4b5fd; border-bottom: 1px solid rgba(255,255,255,0.08); padding-bottom: 0.35rem; }
    .meta { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 0.75rem; margin-bottom: 1.5rem; }
    .meta-item { background: rgba(30, 30, 46, 0.8); padding: 0.75rem 1rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.06); }
    .meta-item strong { display: block; font-size: 0.75rem; color: #71717a; text-transform: uppercase; margin-bottom: 0.25rem; }
    .meta-item span { font-size: 0.95rem; }
    pre, .code { background: rgba(0,0,0,0.35); padding: 1rem; border-radius: 8px; overflow-x: auto; font-size: 0.85rem; white-space: pre-wrap; word-break: break-word; border: 1px solid rgba(255,255,255,0.06); }
    .tree { font-family: ui-monospace, monospace; }
    table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
    th, td { text-align: left; padding: 0.6rem 0.75rem; border-bottom: 1px solid rgba(255,255,255,0.08); }
    th { color: #71717a; font-weight: 600; }
    .method { display: inline-block; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; }
    .method.get { background: rgba(34, 197, 94, 0.25); color: #86efac; }
    .method.post { background: rgba(59, 130, 246, 0.25); color: #93c5fd; }
    .method.put { background: rgba(234, 179, 8, 0.25); color: #fde047; }
    .method.delete { background: rgba(239, 68, 68, 0.25); color: #fca5a5; }
    .method.patch { background: rgba(168, 85, 247, 0.25); color: #e9d5ff; }
    .method.all { background: rgba(113, 113, 122, 0.3); color: #d4d4d8; }
    .section { background: rgba(30, 30, 46, 0.5); border-radius: 10px; padding: 1.25rem; margin-bottom: 1.25rem; border: 1px solid rgba(255,255,255,0.06); }
    .readme { max-height: 320px; overflow-y: auto; }
    ul { margin: 0.5rem 0; padding-left: 1.25rem; }
    li { margin: 0.25rem 0; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="back"><a href="/">← Back to analyzer</a></div>
    <h1>Analysis: <%= repoUrl %></h1>

    <div class="meta">
      <div class="meta-item"><strong>Language</strong><span><%= language || '—' %></span></div>
      <div class="meta-item"><strong>Framework</strong><span><%= framework || '—' %></span></div>
      <div class="meta-item"><strong>Architecture</strong><span><%= architecture || '—' %></span></div>
      <div class="meta-item"><strong>Entry point</strong><span><%= entryPoint || '—' %></span></div>
      <% if (typeof projectType !== 'undefined' && projectType) { %>
        <div class="meta-item"><strong>Project type</strong><span><%= projectType %></span></div>
      <% } %>
    </div>

    <% if (typeof partialAnalysisWarning !== 'undefined' && partialAnalysisWarning) { %>
      <div class="section" style="background: rgba(234, 179, 8, 0.15); border-color: rgba(234, 179, 8, 0.4);">
        <p style="margin: 0; color: #fde047;">⚠ Large repository — partial results generated.</p>
      </div>
    <% } %>

    <h2>Folder tree</h2>
    <div class="section">
      <pre class="tree"><%= (typeof folderTreeText !== 'undefined' && folderTreeText ? folderTreeText : '(no tree)').replace(/</g, '&lt;').replace(/>/g, '&gt;') %></pre>
    </div>

    <h2>Routes</h2>
    <div class="section">
      <% if (routes && routes.length) { %>
        <p><strong>Backend routes</strong></p>
        <table>
          <thead><tr><th>Method</th><th>Path</th><th>Handler</th><th>Source</th></tr></thead>
          <tbody>
            <% routes.forEach(function(r) { %>
              <tr>
                <td><span class="method <%= (r.method || '').toLowerCase() %>"><%= r.method || '—' %></span></td>
                <td><%= r.path || '—' %></td>
                <td><%= r.handler || '—' %></td>
                <td><%= r.sourceFile || '—' %></td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      <% } else { %>
        <p>No backend routes detected.</p>
      <% } %>
    </div>

    <% if (frontendModules && frontendModules.length && frontendModules[0].routes && frontendModules[0].routes.length) { %>
      <h2>Frontend routes</h2>
      <div class="section">
        <p><strong><%= frontendModules[0].framework || 'Frontend' %> — <%= frontendModules[0].routes.length %> route(s)</strong></p>
        <table>
          <thead><tr><th>Path</th><th>Component / Type</th><th>Source</th></tr></thead>
          <tbody>
            <% frontendModules[0].routes.forEach(function(r) { %>
              <tr>
                <td><%= r.path || '—' %></td>
                <td><%= r.component || '—' %> <%= r.type ? '(' + r.type + ')' : '' %></td>
                <td><%= r.file || '—' %></td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    <% } %>

    <h2>Controllers</h2>
    <div class="section">
      <% if (controllers && controllers.length) { %>
        <ul>
          <% controllers.forEach(function(c) { %>
            <li><strong><%= c.name %></strong> (<%= c.file %>) — <%= (c.methods || []).join(', ') || '—' %></li>
          <% }); %>
        </ul>
      <% } else { %>
        <p>No controllers detected.</p>
      <% } %>
    </div>

    <h2>Models</h2>
    <div class="section">
      <% if (models && models.length) { %>
        <ul>
          <% models.forEach(function(m) { %>
            <li><strong><%= m.name %></strong> (<%= m.file %>) — <%= m.schemaSummary || '—' %></li>
          <% }); %>
        </ul>
      <% } else { %>
        <p>No models detected.</p>
      <% } %>
    </div>

    <% if (readmeSummary) { %>
      <h2>README summary</h2>
      <div class="section readme">
        <pre class="code"><%= readmeSummary.replace(/</g, '&lt;').replace(/>/g, '&gt;') %></pre>
      </div>
    <% } %>

    <h2>Summary & execution flow</h2>
    <div class="section">
      <pre class="code"><%= explanation && explanation.summary ? explanation.summary : '' %></pre>
      <h3 style="margin-top: 1rem; font-size: 1rem;">Execution flow</h3>
      <pre class="code"><%= explanation && explanation.executionFlow ? explanation.executionFlow : '' %></pre>
    </div>
  </div>
</body>
</html>
